(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.WebSocketClient=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createBackoff=createBackoff;var backoff={exponential:function exponential(attempt,delay){return Math.floor(Math.random()*Math.pow(2,attempt)*delay)},fibonacci:function fibonacci(attempt,delay){var current=1;if(attempt>current){var prev=1,current=2;for(var index=2;index<attempt;index++){var next=prev+current;prev=current;current=next}}return Math.floor(Math.random()*current*delay)}};function createBackoff(type,options){return new Backoff(backoff[type],options)}function Backoff(func,options){this.func=func;this.attempts=0;this.delay=typeof options.initialDelay!=="undefined"?options.initialDelay:100}Backoff.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var createBackoff=require("./backoff").createBackoff;var WebSocketClient=function(){function WebSocketClient(url,protocols){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,WebSocketClient);this.url=url;this.protocols=protocols;this.reconnectEnabled=true;this.listeners={};this.backoff=createBackoff(options.backoff||"exponential",options);this.backoff.onReady=this.onBackoffReady.bind(this);this.open()}_createClass(WebSocketClient,[{key:"open",value:function open(){var reconnect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.isReconnect=reconnect;var binaryType=this.ws&&this.ws.binaryType;this.ws=new WebSocket(this.url,this.protocols);this.ws.onclose=this.onCloseCallback.bind(this);this.ws.onerror=this.onErrorCallback.bind(this);this.ws.onmessage=this.onMessageCallback.bind(this);this.ws.onopen=this.onOpenCallback.bind(this);if(binaryType){this.ws.binaryType=binaryType}}},{key:"onBackoffReady",value:function onBackoffReady(number,delay){this.open(true)}},{key:"onCloseCallback",value:function onCloseCallback(e){if(!this.isReconnect&&this.listeners["onclose"]){this.listeners["onclose"].apply(null,arguments)}if(this.reconnectEnabled&&e.code<3e3){this.backoff.backoff()}}},{key:"onErrorCallback",value:function onErrorCallback(){if(this.listeners["onerror"]){this.listeners["onerror"].apply(null,arguments)}}},{key:"onMessageCallback",value:function onMessageCallback(){if(this.listeners["onmessage"]){this.listeners["onmessage"].apply(null,arguments)}}},{key:"onOpenCallback",value:function onOpenCallback(){if(this.listeners["onopen"]){this.listeners["onopen"].apply(null,arguments)}if(this.isReconnect&&this.listeners["onreconnect"]){this.listeners["onreconnect"].apply(null,arguments)}this.isReconnect=false}},{key:"close",value:function close(code,reason){if(typeof code=="undefined"){code=1e3}this.reconnectEnabled=false;this.ws.close(code,reason)}},{key:"send",value:function send(data){this.ws.send(data)}},{key:"bufferedAmount",get:function get(){return this.ws.bufferedAmount}},{key:"readyState",get:function get(){return this.ws.readyState}},{key:"binaryType",get:function get(){return this.ws.binaryType},set:function set(binaryType){this.ws.binaryType=binaryType}},{key:"extensions",get:function get(){return this.ws.extensions},set:function set(extensions){this.ws.extensions=extensions}},{key:"protocol",get:function get(){return this.ws.protocol},set:function set(protocol){this.ws.protocol=protocol}},{key:"onclose",set:function set(listener){this.listeners["onclose"]=listener},get:function get(){return this.listeners["onclose"]}},{key:"onerror",set:function set(listener){this.listeners["onerror"]=listener},get:function get(){return this.listeners["onerror"]}},{key:"onmessage",set:function set(listener){this.listeners["onmessage"]=listener},get:function get(){return this.listeners["onmessage"]}},{key:"onopen",set:function set(listener){this.listeners["onopen"]=listener},get:function get(){return this.listeners["onopen"]}},{key:"onreconnect",set:function set(listener){this.listeners["onreconnect"]=listener},get:function get(){return this.listeners["onreconnect"]}}]);return WebSocketClient}();WebSocketClient.CONNECTING=WebSocket.CONNECTING;WebSocketClient.OPEN=WebSocket.OPEN;WebSocketClient.CLOSING=WebSocket.CLOSING;WebSocketClient.CLOSED=WebSocket.CLOSED;exports.default=WebSocketClient},{"./backoff":1}]},{},[2])(2)});
